<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Chamados</title>

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    padding:10px;
    background:#f2f2f2;
}
#mainframe{
    max-width:900px;
    margin:auto;
    background:#fff;
    padding:12px;
    border-radius:6px;
}
h2,h3{
    text-align:center;
    margin:10px 0;
}
button{
    padding:6px 12px;
    margin:4px;
    cursor:pointer;
    font-size:13px;
    border-radius:4px;
    border:none;
}
.btn-nav{background:#6c757d;color:#fff;}
.btn-save{background:#007bff;color:#fff;}
.btn-txt{background:#28a745;color:#fff;}

#formPage,#chamadosPage{display:none;}

label{
    font-weight:600;
    font-size:13px;
    margin-top:6px;
    display:block;
}
input,textarea{
    width:100%;
    padding:6px;
    margin-bottom:6px;
    border:1px solid #ccc;
    border-radius:4px;
    box-sizing:border-box;
    font-size:13px;
}
textarea{height:70px;resize:vertical;}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
    font-size:12px;
}
th,td{
    border:1px solid #ccc;
    padding:6px;
    text-align:left;
    word-break:break-word;
}
th{background:#f0f0f0;}

/* MOBILE */
@media (max-width:768px){
    table,thead,tbody,th,td,tr{display:block;}
    thead{display:none;}
    tr{
        margin-bottom:10px;
        border:1px solid #ccc;
        border-radius:4px;
        padding:6px;
        background:#fafafa;
    }
    td{
        border:none;
        padding-left:45%;
        position:relative;
    }
    td:before{
        position:absolute;
        left:6px;
        top:6px;
        width:40%;
        font-weight:bold;
        white-space:nowrap;
    }
    td:nth-child(1):before{content:"Data";}
    td:nth-child(2):before{content:"T√≠tulo";}
    td:nth-child(3):before{content:"Solicitante";}
    td:nth-child(4):before{content:"Centro Custo";}
    td:nth-child(5):before{content:"Unidade";}
    td:nth-child(6):before{content:"Departamento";}
    td:nth-child(7):before{content:"Contato";}
    td:nth-child(8):before{content:"Email";}
    td:nth-child(9):before{content:"Previs√£o";}
    td:nth-child(10):before{content:"Descri√ß√£o";}
    td:nth-child(11):before{content:"Equipamento";}
}
</style>
</head>

<body>
<div id="mainframe">

<h2>Sistema de Chamados</h2>

<!-- BOT√ïES -->
<div style="text-align:center">
  <button class="btn-nav" onclick="abrirForm()">FORMUL√ÅRIO</button>
  <button class="btn-nav" onclick="abrirChamados()">CHAMADOS</button>
</div>

<!-- FORMUL√ÅRIO -->
<div id="formPage">
<h3>Formul√°rio de Chamado</h3>

<label>T√≠tulo</label><input id="titulo">
<label>Solicitante</label><input id="solicitante">
<label>Centro de Custo</label><input id="cc">
<label>Unidade</label><input id="unidade">
<label>Departamento</label><input id="departamento">
<label>Contato</label><input id="contato">
<label>Email</label><input id="email">
<label>Previs√£o</label><input id="previsao">
<label>Descri√ß√£o</label><textarea id="descricao"></textarea>
<label>Equipamento</label><input id="equipamento">

<button class="btn-save" onclick="salvarChamado()">Salvar Chamado</button>
<button class="btn-txt" onclick="gerarTXT()">Gerar TXT</button>
</div>

<!-- CHAMADOS -->
<div id="chamadosPage">
<h3>Chamados Salvos (Espelhado do Google Sheets)</h3>

<table>
<thead>
<tr>
<th>Data</th>
<th>T√≠tulo</th>
<th>Solicitante</th>
<th>Centro de Custo</th>
<th>Unidade</th>
<th>Departamento</th>
<th>Contato</th>
<th>Email</th>
<th>Previs√£o</th>
<th>Descri√ß√£o</th>
<th>Equipamento</th>
</tr>
</thead>
<tbody id="listaChamados"></tbody>
</table>
</div>

</div>

<script>
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwbU4lhBDsPbz-PFEgmHwhXLncUzeyxQjQKkjlXLv3LflWxWnODTDvUGCl_BYAkbNJJQQ/exec';

/* ABAS */
function abrirForm(){
  formPage.style.display="block";
  chamadosPage.style.display="none";
}
function abrirChamados(){
  formPage.style.display="none";
  chamadosPage.style.display="block";
  carregarChamados(); // üîÅ ESPELHA A PLANILHA
}

/* SALVAR CHAMADO */
function salvarChamado() {
  const params = new URLSearchParams();
  params.append('titulo', titulo.value);
  params.append('solicitante', solicitante.value);
  params.append('cc', cc.value);
  params.append('unidade', unidade.value);
  params.append('departamento', departamento.value);
  params.append('contato', contato.value);
  params.append('email', email.value);
  params.append('previsao', previsao.value);
  params.append('descricao', descricao.value);
  params.append('equipamento', equipamento.value);

  fetch(WEB_APP_URL, {
    method: 'POST',
    body: params
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'ok') {
      alert('Chamado salvo com sucesso!');
      document.querySelectorAll('#formPage input, #formPage textarea')
        .forEach(i => i.value = '');
      abrirChamados(); // ‚úÖ ESPELHA AUTOMATICAMENTE
    } else {
      alert('Erro: ' + data.message);
    }
  })
  .catch(err => alert('Erro ao enviar: ' + err));
}

/* CARREGAR CHAMADOS (GOOGLE SHEETS) */
function carregarChamados(){
  fetch(WEB_APP_URL)
    .then(res=>res.json())
    .then(data=>{
      const tbody=document.getElementById('listaChamados');
      tbody.innerHTML='';
      data.forEach((row,index)=>{
        if(index===0) return;
        const tr=document.createElement('tr');
        row.forEach(cell=>{
          const td=document.createElement('td');
          td.textContent=cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    });
}

/* GERAR TXT */
function gerarTXT(){
  let texto='';
  const labels=document.querySelectorAll('#formPage label');
  const fields=document.querySelectorAll('#formPage input, #formPage textarea');
  labels.forEach((l,i)=>{
    texto += `${l.textContent}: ${fields[i].value}\n`;
  });
  const blob=new Blob([texto],{type:"text/plain"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="chamado.txt";
  link.click();
}

/* ABRIR FORM POR PADR√ÉO */
abrirForm();
</script>

</body>
</html>
